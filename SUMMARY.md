# –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã

### 1. Ô∏è –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç? –û—Ç –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?

**–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –±–∞–∑—ã 1–°:**

- **–ë–∞–∑–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–∏—Å–∫–µ (C:, D:, E:)** ‚Üí –ó–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç **SYSTEM** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ NSSM)
  ```powershell
  nssm install OneCBackupBot "–ø—É—Ç—å\–∫\python.exe" "–ø—É—Ç—å\–∫\main.py"
  nssm start OneCBackupBot
  ```

- **–ë–∞–∑–∞ –Ω–∞ —Å–µ—Ç–µ–≤–æ–º –¥–∏—Å–∫–µ (\\\\server\\share)** ‚Üí –ó–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç **–¥–æ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
  ```powershell
  nssm install OneCBackupBot "–ø—É—Ç—å\–∫\python.exe" "–ø—É—Ç—å\–∫\main.py"
  nssm set OneCBackupBot ObjectName "DOMAIN\Username" "Password"
  nssm start OneCBackupBot
  ```

üìÑ **–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** `SERVICE_SETUP.md`

---

### 2. Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana (–ª–æ–∫–∞–ª—å–Ω—ã–π Prometheus)

–ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ `/api/metrics.prom`. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ö–µ–º–∞: Prometheus –ª–æ–∫–∞–ª—å–Ω–æ —Å–∫—Ä–µ–π–ø–∏—Ç —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç, Grafana —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã.

–ü—Ä–∏–º–µ—Ä scrape-–∫–æ–Ω—Ñ–∏–≥–∞ Prometheus:
```yaml
scrape_configs:
  - job_name: 'onec_backup_bot'
    static_configs:
      - targets: ['<SERVER_IP>:8080']
    metrics_path: /api/metrics.prom
```

üìä **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `GRAFANA_INTEGRATION.md`

---

### 3. Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–±–æ—Ä –í–°–ï–• –≤–æ–∑–º–æ–∂–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫!**

#### –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫):

##### CPU
- –û–±—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (%)
- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —è–¥—Ä–∞–º
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö/–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —è–¥–µ—Ä
- –¢–µ–∫—É—â–∞—è/–º–∏–Ω/–º–∞–∫—Å —á–∞—Å—Ç–æ—Ç–∞ (MHz)
- User/System/Idle –≤—Ä–µ–º—è

##### –ü–∞–º—è—Ç—å
- –û–±—â–µ–µ/–î–æ—Å—Ç—É–ø–Ω–æ/–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ/–°–≤–æ–±–æ–¥–Ω–æ (bytes)
- –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è RAM
- Swap: Total/Used/Free/Percent

##### –î–∏—Å–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ —Å –±—ç–∫–∞–ø–∞–º–∏ (%)
- –í—Å–µ–≥–æ/–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ/–°–≤–æ–±–æ–¥–Ω–æ –Ω–∞ –≤—Å–µ—Ö –¥–∏—Å–∫–∞—Ö
- **–î–∏—Å–∫ I/O:**
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
  - –ë–∞–π—Ç—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–æ/–∑–∞–ø–∏—Å–∞–Ω–æ
  - –í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ (ms)

##### –°–µ—Ç—å
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ/–ü–æ–ª—É—á–µ–Ω–æ –±–∞–π—Ç –∏ –ø–∞–∫–µ—Ç–æ–≤
- –û—à–∏–±–∫–∏ (in/out)
- –ü–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤ (drop in/out)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

##### –ü—Ä–æ—Ü–µ—Å—Å—ã
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –¢–æ–ø-5 –ø–æ CPU
- –¢–æ–ø-5 –ø–æ RAM

##### **RDP –°–µ—Å—Å–∏–∏ (Windows)**
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö RDP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π —Å –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏

##### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤—Ä–µ–º–µ–Ω–µ–º –≤—Ö–æ–¥–∞

##### –°–∏—Å—Ç–µ–º–∞
- Hostname
- –û–° (Windows/Linux)
- –í–µ—Ä—Å–∏—è –û–°
- Uptime (—Å–µ–∫—É–Ω–¥—ã)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

##### –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞ (success/failed)
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (bytes)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
- Timestamp

#### –ö–æ–¥ –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫:
```python
# –í onec_backup_bot/metrics_extended.py
from onec_backup_bot.metrics_extended import collect_all_metrics

# –°–æ–±–µ—Ä–µ—Ç –í–°–ï –º–µ—Ç—Ä–∏–∫–∏
metrics = collect_all_metrics(backup_dir=Path("D:\\1C_Backups"))

# metrics —Å–æ–¥–µ—Ä–∂–∏—Ç:
# {
#   "cpu_percent": 45.2,
#   "memory_percent": 67.1,
#   "disk_percent": 82.3,
#   "rdp_active_count": 3,
#   "network": {...},
#   "processes": {...},
#   ...
# }
```

üìà **–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫:** –°–º. `GRAFANA_INTEGRATION.md` ‚Üí —Ä–∞–∑–¥–µ–ª "–°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏"

---

### 4. Ô∏è –ü—É—Ç–∏ –∫ –±–∞–∑–µ –∏ –±—ç–∫–∞–ø–∞–º –≤ .env

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ!** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –ø—É—Ç–∏ –≤ `.env`:

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π .env.example:
```env
# ===== –ü—É—Ç–∏ –∫ –±–∞–∑–µ 1–° –∏ –±—ç–∫–∞–ø–∞–º =====
# –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ 1cv8.exe
ONEC_EXE=C:\Program Files (x86)\1cv8\8.3.24.1368\bin\1cv8.exe

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª–æ–≤–æ–π –±–∞–∑–µ 1–° (–ø–∞–ø–∫–∞ —Å .1CD —Ñ–∞–π–ª–æ–º)
ONEC_BASE_PATH=D:\1C_Bases\MyDatabase

# –ü–∞–ø–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π (–±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –ø–æ–¥–ø–∞–ø–∫–∏ –ø–æ –¥–∞—Ç–∞–º)
BACKUP_DIR=D:\1C_Backups
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏:
1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)** ‚Äî –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
2. **config.yaml** ‚Äî –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ –≤ .env
3. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –µ—Å–ª–∏ –Ω–∏–≥–¥–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ

#### –ü—Ä–∏–º–µ—Ä:
```env
# –í .env
ONEC_BASE_PATH=D:\Production\1C_Database
BACKUP_DIR=E:\Backups\1C

# config.yaml –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

---

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### 1. **onec_backup_bot/grafana.py**
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus:
- –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ Pushgateway (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –±—ç–∫–∞–ø–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏)

### 2. **onec_backup_bot/metrics_extended.py**
–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫:
- `collect_all_metrics()` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –í–°–ï –º–µ—Ç—Ä–∏–∫–∏
- `get_rdp_sessions()` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ RDP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `get_cpu_detailed()` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ CPU
- `get_memory_detailed()` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ RAM
- `get_disk_detailed()` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏—Å–∫–∞—Ö
- `get_network_stats()` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏
- `get_process_stats()` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- `flatten_metrics_for_prometheus()` ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è Prometheus

### 3. **onec_backup_bot/metrics_worker.py**
–§–æ–Ω–æ–≤—ã–π worker –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ—Ç—Ä–∏–∫ (default: 60 —Å–µ–∫)
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –±—ç–∫–∞–ø–æ–≤
- Graceful shutdown

### 4. **GRAFANA_INTEGRATION.md**
–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–º—É Prometheus + Grafana:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Prometheus
- –°–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫
- –ì–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –∏ PromQL
- –ü—Ä–∏–º–µ—Ä—ã PromQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
- API endpoints

### 5. **SERVICE_SETUP.md**
–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∫–∞–∫ —Å–ª—É–∂–±—ã:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ NSSM
- –í—ã–±–æ—Ä —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
- Task Scheduler –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
- Troubleshooting

### 6. **SUMMARY.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
–ò—Ç–æ–≥–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

---

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. **.env.example**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏: `ONEC_EXE`, `ONEC_BASE_PATH`, `BACKUP_DIR`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Grafana/Prometheus
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è InfluxDB
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è Loki
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `METRICS_INTERVAL`

### 2. **config.py**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—É—Ç–µ–π
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `.env` > `config.yaml` > defaults

### 3. **main.py**
- –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫ `MetricsWorker`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ worker –ø—Ä–∏ shutdown

### 4. **README.md**
- –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Grafana"
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `.env`

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Grafana Cloud

#### 1. –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç
```
https://grafana.com/ ‚Üí Sign Up (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 10k –º–µ—Ç—Ä–∏–∫)
```

#### 2. –ü–æ–ª—É—á–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–í Grafana Cloud:
- Configuration ‚Üí Data Sources ‚Üí Prometheus
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL, User, Password

#### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env
```env
# Telegram
BOT_TOKEN=your_bot_token
ALLOWED_USER_IDS=123456789

# –ü—É—Ç–∏
ONEC_EXE=C:\Program Files (x86)\1cv8\8.3.24.1368\bin\1cv8.exe
ONEC_BASE_PATH=D:\1C_Bases\Production
BACKUP_DIR=D:\1C_Backups

# Grafana Cloud
GRAFANA_PROMETHEUS_URL=https://prometheus-prod-XX-xxx.grafana.net/api/prom/push
GRAFANA_PROMETHEUS_USER=123456
GRAFANA_PROMETHEUS_PASSWORD=glc_xxxxxxxxxxxxx
METRICS_INTERVAL=60
```

#### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python main.py

# –ò–ª–∏ –∫–∞–∫ —Å–ª—É–∂–±—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
nssm install OneCBackupBot "–ø—É—Ç—å\–∫\python.exe" "–ø—É—Ç—å\–∫\main.py"
nssm start OneCBackupBot
```

#### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Grafana
- Explore ‚Üí Prometheus
- Query: `onec_cpu_percent`
- –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≥—Ä–∞—Ñ–∏–∫

#### 6. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã
–°–º. –≥–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ `GRAFANA_INTEGRATION.md`

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
```powershell
python main.py
# –í –ª–æ–≥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "Metrics worker started (interval: 60s)"
# "Sent N metrics to Prometheus"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –±–æ—Ç–∞
```
/health
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: CPU, RAM, Disk, –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
```
/backup
```
–î–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É: `BACKUP_DIR/2025-01-03/Prefix_2025-01-03_12-34-56.zip`

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Grafana
```
Explore ‚Üí Prometheus ‚Üí Query: onec_cpu_percent
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)

```
OneCBackupBot/
‚îú‚îÄ‚îÄ .env.example                    # ‚Üê –û–ë–ù–û–í–õ–ï–ù (–ø—É—Ç–∏, Grafana)
‚îú‚îÄ‚îÄ config.yaml                      # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py                          # ‚Üê –û–ë–ù–û–í–õ–ï–ù (MetricsWorker)
‚îú‚îÄ‚îÄ requirements.txt                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md                        # ‚Üê –û–ë–ù–û–í–õ–ï–ù (Grafana —Å–µ–∫—Ü–∏—è)
‚îú‚îÄ‚îÄ OPERATIONS.md                    # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îú‚îÄ‚îÄ CHANGES.md                       # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ GRAFANA_INTEGRATION.md          # ‚Üê –ù–û–í–´–ô: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Grafana
‚îú‚îÄ‚îÄ SERVICE_SETUP.md                # ‚Üê –ù–û–í–´–ô: –ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–ª—É–∂–±–∞
‚îú‚îÄ‚îÄ SUMMARY.md                      # ‚Üê –ù–û–í–´–ô: –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ onec_backup_bot/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ backup.py                   # –õ–æ–≥–∏–∫–∞ –±—ç–∫–∞–ø–∞
    ‚îú‚îÄ‚îÄ bot.py                      # Telegram –∫–æ–º–∞–Ω–¥—ã
    ‚îú‚îÄ‚îÄ config.py                   # ‚Üê –û–ë–ù–û–í–õ–ï–ù (env paths)
    ‚îú‚îÄ‚îÄ db.py                       # SQLite
    ‚îú‚îÄ‚îÄ logger.py                   # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    ‚îú‚îÄ‚îÄ metrics.py                  # –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω)
    ‚îú‚îÄ‚îÄ grafana.py                  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus (–ª–æ–∫–∞–ª—å–Ω–æ)
    ‚îú‚îÄ‚îÄ metrics_extended.py         # ‚Üê –ù–û–í–´–ô: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
    ‚îî‚îÄ‚îÄ metrics_worker.py           # ‚Üê –ù–û–í–´–ô: –§–æ–Ω–æ–≤—ã–π worker
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–∏–º–µ—Ä—ã –º–µ—Ç—Ä–∏–∫ | Grafana Query |
|-----------|---------------|---------------|
| **CPU** | –ó–∞–≥—Ä—É–∑–∫–∞, —á–∞—Å—Ç–æ—Ç–∞, —è–¥—Ä–∞ | `onec_cpu_percent` |
| **RAM** | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, swap | `onec_memory_percent` |
| **Disk** | –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ, I/O | `onec_disk_percent` |
| **Network** | –¢—Ä–∞—Ñ–∏–∫, –æ—à–∏–±–∫–∏ | `rate(onec_network_bytes_recv[5m])` |
| **RDP** | –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | `onec_rdp_active_count` |
| **Processes** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | `onec_processes_total_count` |
| **System** | Uptime | `onec_uptime_seconds / 3600` (—á–∞—Å—ã) |
| **Backups** | –°—Ç–∞—Ç—É—Å, —Ä–∞–∑–º–µ—Ä | `onec_backup_status` |

**–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫:** `GRAFANA_INTEGRATION.md`

---

## FAQ

### Q: –ú–µ—Ç—Ä–∏–∫–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
**A:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –í –ª–æ–≥–µ –µ—Å—Ç—å "Metrics worker started"?
2. `GRAFANA_PROMETHEUS_URL` –∑–∞–ø–æ–ª–Ω–µ–Ω –≤ `.env`?
3. –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ endpoint? `curl $GRAFANA_PROMETHEUS_URL`

### Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID?
**A:** –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É @userinfobot

### Q: –ë–∞–∑–∞ –Ω–∞ —Å–µ—Ç–µ–≤–æ–º –¥–∏—Å–∫–µ, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å?
**A:** –°–º. `SERVICE_SETUP.md` ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 2 (Domain User)

### Q: –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏?
**A:** 
```python
python
>>> from onec_backup_bot.metrics_extended import collect_all_metrics
>>> from pathlib import Path
>>> metrics = collect_all_metrics(Path("D:\\1C_Backups"))
>>> print(metrics.keys())
```

### Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å Grafana?
**A:** –î–∞, –ø—Ä–æ—Å—Ç–æ –Ω–µ –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ `GRAFANA_PROMETHEUS_URL` –≤ `.env`

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env** —Å –ø—É—Ç—è–º–∏ –∏ Grafana credentials
2. ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–∫ —Å–ª—É–∂–±—É** (—Å–º. `SERVICE_SETUP.md`)
3. ‚úÖ **–°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã** –≤ Grafana (—Å–º. `GRAFANA_INTEGRATION.md`)
4. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
5. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –∫–æ–º–∞–Ω–¥—É `/backup` –≤ Telegram
6. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** –º–µ—Ç—Ä–∏–∫–∏ –≤ Grafana —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `README.md`, `OPERATIONS.md`, `GRAFANA_INTEGRATION.md`
- **–ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–ª—É–∂–±–∞:** `SERVICE_SETUP.md`
- **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:** `CHANGES.md`
- **–≠—Ç–æ—Ç —Ñ–∞–π–ª:** `SUMMARY.md`

–í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
