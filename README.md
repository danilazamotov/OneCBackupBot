# OneC Backup Bot

Telegram-–±–æ—Ç –¥–ª—è **—Ä—É—á–Ω–æ–≥–æ** —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤–æ–π –±–∞–∑—ã 1–° —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –≤ Telegram.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –í—ã–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã 1–° –≤ `.dt` —á–µ—Ä–µ–∑ `DESIGNER /F ... /DumpIB` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ `/N` –∏ `/P`)
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ –≤ ZIP (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —Å—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è)
- ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–ø–∏–π –ø–æ –¥–∞—Ç–∞–º (–ø–∞–ø–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è: `YYYY-MM-DD`)
- ‚úÖ Telegram-–±–æ—Ç: `/backup`, `/status`, `/health`, `/lastlog`
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** CPU, RAM, Disk, Network, RDP —Å–µ—Å—Å–∏–∏, –ø—Ä–æ—Ü–µ—Å—Å—ã
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana:** Prometheus, InfluxDB, Loki
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π lock) –∏ —Ç–∞–π–º–∞—É—Ç –¥–∞–º–ø–∞
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ (fingerprint) ‚Äî –ø—Ä–æ–ø—É—Å–∫ –±—ç–∫–∞–ø–∞, –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã

**–¢–æ–ª—å–∫–æ —Ä—É—á–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ. –ö–æ–ø–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ –∫–æ–º–∞–Ω–¥–µ `/backup` –≤ Telegram.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Windows Server 2019/2022, Python 3.10+
- 1–° 8.3 (—Ç–æ–Ω–∫–∏–π –∫–ª–∏–µ–Ω—Ç) ‚Äî –ø—É—Ç—å –∫ `1cv8.exe`
- Telegram –±–æ—Ç (—Ç–æ–∫–µ–Ω –æ—Ç @BotFather)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
```env
BOT_TOKEN=your_bot_token_from_botfather
ALLOWED_USER_IDS=123456789,987654321

# –ü—É—Ç–∏ (–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ .env –∏–ª–∏ config.yaml)
ONEC_EXE=C:\Program Files (x86)\1cv8\8.3.24.1368\bin\1cv8.exe
ONEC_BASE_PATH=D:\1C_Bases\MyDatabase
BACKUP_DIR=D:\1C_Backups

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ 1–°
ONEC_UC=–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
ONEC_UP=–ø–∞—Ä–æ–ª—å

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Grafana Cloud –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
GRAFANA_PROMETHEUS_URL=https://prometheus-prod-XX-xxx.grafana.net/api/prom/push
GRAFANA_PROMETHEUS_USER=123456
GRAFANA_PROMETHEUS_PASSWORD=your_token_here
METRICS_INTERVAL=60
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.yaml`:
- `onec.exe` ‚Äî –ø—É—Ç—å –∫ `1cv8.exe`
- `onec.base_path` ‚Äî –ø–∞–ø–∫–∞ —Å –±–∞–∑–æ–π 1–° (–≥–¥–µ `.1CD`)
- `backup.backup_dir` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±—ç–∫–∞–ø–æ–≤
- `backup.compress` ‚Äî `zip` –∏–ª–∏ `none`

### 4. –ó–∞–ø—É—Å–∫
```powershell
python main.py
```

–í Telegram –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:
- `/help` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `/backup` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
- `/status` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- `/health` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ –¥–∞—Ç–∞–º:
```
backup_dir/
‚îú‚îÄ‚îÄ 2025-01-15/
‚îÇ   ‚îú‚îÄ‚îÄ Zernosbyt_2025-01-15_10-30-45.zip
‚îÇ   ‚îî‚îÄ‚îÄ Zernosbyt_2025-01-15_14-15-30.zip
‚îú‚îÄ‚îÄ 2025-01-16/
‚îÇ   ‚îî‚îÄ‚îÄ Zernosbyt_2025-01-16_09-00-12.zip
‚îú‚îÄ‚îÄ backup.log
‚îî‚îÄ‚îÄ app.sqlite3
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/backup` | –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é |
| `/status` | –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –±—ç–∫–∞–ø–æ–≤ |
| `/health` | CPU, RAM, Disk, –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π –±—ç–∫–∞–ø |
| `/lastlog` | –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ 100 —Å—Ç—Ä–æ–∫–∞–º–∏ –ª–æ–≥–∞ |

## –ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–µ—Ä–≤–∏—Å

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `OPERATIONS.md`. –ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:
```powershell
nssm install OneCBackupBot "C:\path\.venv\Scripts\python.exe" "C:\path\main.py"
nssm set OneCBackupBot AppDirectory "C:\path\to\project"
nssm start OneCBackupBot
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- `onec_backup_bot/backup.py` ‚Äî –ª–æ–≥–∏–∫–∞ –±—ç–∫–∞–ø–∞
- `onec_backup_bot/bot.py` ‚Äî telegram-–∫–æ–º–∞–Ω–¥—ã
- `onec_backup_bot/config.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `onec_backup_bot/db.py` ‚Äî SQLite –∏—Å—Ç–æ—Ä–∏—è
- `onec_backup_bot/logger.py` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `onec_backup_bot/uptime.py` ‚Äî Uptime Kuma –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `config.yaml` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ 1–° –≤ –ª–æ–≥–∞—Ö –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è (`***`)
- `.env` –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è (—Å–º. `.gitignore`)
- –î–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö Telegram ID

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å Grafana

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ **Grafana Cloud**, **Prometheus** –∏–ª–∏ **InfluxDB**:

### –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–°–∏—Å—Ç–µ–º–∞:** CPU, RAM, Disk, Network, Uptime
- **RDP —Å–µ—Å—Å–∏–∏:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Windows)
- **–ü—Ä–æ—Ü–µ—Å—Å—ã:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Ç–æ–ø –ø–æ CPU/RAM
- **–î–∏—Å–∫ I/O:** –û–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏, throughput
- **–ë—ç–∫–∞–ø—ã:** –°—Ç–∞—Ç—É—Å, —Ä–∞–∑–º–µ—Ä, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Grafana Cloud:
1. –°–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ https://grafana.com/
2. –ü–æ–ª—É—á–∏—Ç–µ Prometheus Push URL –∏ —Ç–æ–∫–µ–Ω
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```env
   GRAFANA_PROMETHEUS_URL=https://prometheus-prod-XX-xxx.grafana.net/api/prom/push
   GRAFANA_PROMETHEUS_USER=123456
   GRAFANA_PROMETHEUS_PASSWORD=your_token_here
   ```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞—á–Ω—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥!

üìä **–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. `GRAFANA_INTEGRATION.md`

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ S3/–æ–±–ª–∞–∫–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ Windows Task Scheduler
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `OPERATIONS.md`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana: `GRAFANA_INTEGRATION.md`

## –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary/Internal
